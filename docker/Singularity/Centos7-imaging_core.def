# Bootstrap definition example for Centos-7 with the latest Open MPI from GitHub master
# sudo singularity create --size 16384 /mnt/coredata/Singularity/Centos7-imaging_core_1.0.img
# sudo singularity create --size 1024 /mnt/coredata/Singularity/test.img
# in to Docker/docker/Singularity/
# sudo singularity bootstrap /mnt/coredata/Singularity/Centos7-imaging_core_1.0.img Centos7-imaging_core.def
# sudo singularity bootstrap /mnt/coredata/Singularity/test.img simple.def
#
# As a user
# singularity shell --shell /bin/bash -B /mnt/coredata/neuroimaging_CentOS7/:/mnt/neuroimaging  -B /etc/machine-id:/etc/machine-id -B /usr/local/MATLAB:/usr/local/MATLAB /mnt/coredata/Singularity/Centos7-imaging_core_1.0.img
#
# to avoid writing a new image:
# sudo singularity shell --writable  /mnt/coredata/Singularity/Centos7-imaging_core_1.0.img


BootStrap: yum
OSVersion: 7
MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/
Include: yum

%setup
    echo "Looking in directory '$SINGULARITY_ROOTFS' for /bin/sh"
    if [ ! -x "$SINGULARITY_ROOTFS/bin/sh" ]; then
        echo "Hrmm, this container does not have /bin/sh installed..."
        exit 1
    fi
    mkdir $SINGULARITY_ROOTFS/mnt/neuroimaging/ \
    	  $SINGULARITY_ROOTFS/mnt/macdata \
	  $SINGULARITY_ROOTFS/mnt/images \
	  $SINGULARITY_ROOTFS/mnt/tempo \
	  $SINGULARITY_ROOTFS/etc/singularity/
    cp singularity.conf $SINGULARITY_ROOTFS/etc/singularity/
    exit 0

%post
	echo "Installing Development Tools YUM group"
	#yum -y groupinstall "Development Tools"
	yum -y install xeyes
	#mkdir /mnt/neuroimaging/ /mnt/macdata /mnt/images /mnt/tempo /etc/singularity/

	#
	#
	exit 0

%runscript
	echo "Arguments received: $*"
	exec /usr/bin/python "$@"

%test
	#
	
	